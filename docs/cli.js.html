<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: cli.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: cli.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* eslint-disable no-console */
/** @module lib/cli */

import { basename } from 'path'
import readline from 'readline'
import extract from './extract.js'
import format from './format.js'

const errors = {
	general: 1,
	missingArg: 16,
}

class ConsoleError extends Error {
	constructor(code = errors.general, ...params) {
		super(...params)
		this.name = 'ConsoleError'
		this.code = code
	}
}

/**
 * Output help screen.
 */
const help = () => {
	process.stdout.write(`
USAGE: ${basename(process.argv[1])} [&lt;options>] [...&lt;string>]

Extract hashtags from a string or format keywords into hashtags.

String may be specified as arguments or pipe from standard input.

OPTIONS:

	-e --extract     Extract hashtags from input.
	-f --format      Format keywords into hashtags.
	-h --help        Show this help screen.

`)
}

process.on('uncaughtException', e => {
	process.stderr.write(`${e}\n`)
	if (e.code === errors.missingArg) help()
	process.exit(e.code || errors.general)
})

process.on('unhandledRejection', e => { throw e })

/**
 * Return a line to be output.
 * @param {string|string[]} line String or array of strings to be output as a single line.
 * @returns {string} Line to be output.
 */
export const outputLine = line => `${[...[line].flat(Infinity)].join(' ')}\n`

/**
 * Process standard input with readline.
 * @param {function} func Function to process every string line.
 * @returns {Promise} Promise object processing every line with readline.
 */
const readStdin = func => new Promise(resolve => {
	readline.createInterface({
		input: process.stdin,
		output: process.stdout,
		terminal: false,
	}).on('line', line => {
		process.stdout.write(outputLine(func(line)))
	}).on('close', () => {
		resolve()
	})
})

/**
 * Process arguments with specified function.
 * If the arguments are empty, will use standard input instead.
 * @param {function} func Function to process every string line.
 * @param {...any} args Arguments to pass to function above.
 */
const run = async (func, ...args) => {
	if (args.length) {
		process.stdout.write(outputLine(func(...args)))
		return
	}

	await readStdin(func)
}

export default async (opt, ...argv) => {
	switch (opt) {
		case '-e':
		case '--extract':
			await run(extract, ...argv)
			break

		case '-f':
		case '--format':
			await run(format, ...argv)
			break

		case '-h':
		case '--help':
			help()
			break

		default:
			throw new ConsoleError(
				errors.missingArg,
				'Invalid argument. Pass -h for help screen.',
			)
	}

	return 0
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-lib_cli.html">lib/cli</a></li><li><a href="module-lib_extract.html">lib/extract</a></li><li><a href="module-lib_format.html">lib/format</a></li><li><a href="module-lib_index.html">lib/index</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Tue Sep 13 2022 21:09:53 GMT+0900 (Japan Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
